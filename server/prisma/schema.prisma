// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ============================================
// 0. Multi-Tenant (Company/Tenant)
// ============================================

model Company {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(255)
  email     String?  @db.VarChar(255)
  phone     String?  @db.VarChar(50)
  address   String?  @db.Text
  industry  String?  @db.VarChar(100)
  website   String?  @db.VarChar(255)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  users                User[]
  employees            Employee[]
  departments          Department[]
  clients                  Client[]
  clientApprovalRequests   ClientApprovalRequest[]
  tasks                    Task[]
  invoices             Invoice[]
  transactions         Transaction[]
  budgets              Budget[]
  accountsPayable      AccountPayable[]
  accountsReceivable   AccountReceivable[]
  companyContacts      CompanyContact[]
  contracts            Contract[]
  integrations         Integration[]
  socialConversations  SocialConversation[]
  expenseCategories    ExpenseCategory[]
  leads                Lead[]
  leadMeetings         LeadMeeting[]
  leadCalls            LeadCall[]
  leadCategories       LeadCategory[]
  leadInterests        LeadInterest[]
  systemSettings       SystemSetting[]
  campaigns            Campaign[]
  products             Product[]
  productCategories    ProductCategory[]
  serviceCategories    ServiceCategory[]
  services             Service[]
  projects             Project[]
  reviews              Review[]
  blogPosts            BlogPost[]
  paymentGateways      PaymentGateway[]
  payments             Payment[]
  employeeGroups       EmployeeGroup[]
  conversationReleases ConversationRelease[]
  conversationLabels   ConversationLabel[]
  workSessions         WorkSession[]
  subTasks             SubTask[]
  taskAttachments      TaskAttachment[]
  taskConversations    TaskConversation[]
  activityLogs         ActivityLog[]
  screenCaptures       ScreenCapture[]
  facebookAppConfigs   FacebookAppConfig[]

  @@index([name])
  @@index([isActive])
  @@map("companies")
}

// ============================================
// 1. Authentication & Users
// ============================================

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique @db.VarChar(50)
  permissions Json // e.g., {"can_manage_companies": true, "can_manage_inbox": false}
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  users User[]

  @@map("roles")
}

model User {
  id           String   @id @default(uuid())
  name         String?  @db.VarChar(255)
  email        String   @db.VarChar(255)
  phone        String?  @db.VarChar(50)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  address      String?  @db.Text
  education    String?  @db.Text
  roleId       Int      @map("role_id")
  companyId    Int      @map("company_id")
  profileImage String?  @map("profile_image") @db.Text
  eSignature   String?  @map("e_signature") @db.Text
  isOnline     Boolean  @default(false) @map("is_online")
  lastOnlineAt DateTime? @map("last_online_at") @db.DateTime
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  role                   Role             @relation(fields: [roleId], references: [id], onDelete: Restrict)
  company                Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee               Employee?
  workSessions           WorkSession[]
  taskComments           TaskComment[]
  createdLeads                    Lead[]                   @relation("LeadCreator")
  monitoredLeads                  Lead[]                   @relation("LeadMonitoringManager")
  projects                       Project[]
  campaignClients                CampaignClient[]
  createdEmployeeGroups          EmployeeGroup[]
  createdTaskAttachments         TaskAttachment[]          @relation("UserTaskAttachments")
  taskMessages                   TaskMessage[]             @relation("UserTaskMessages")
  clientApprovalRequestsRequested ClientApprovalRequest[]  @relation("ClientApprovalRequestedBy")
  clientApprovalRequestsApproved  ClientApprovalRequest[]  @relation("ClientApprovalApprovedBy")
  activityLogs                    ActivityLog[]
  screenCaptures                  ScreenCapture[]

  @@unique([email, companyId])
  @@index([email])
  @@index([roleId])
  @@index([companyId])
  @@map("users")
}

model WorkSession {
  id        Int       @id @default(autoincrement())
  userId    String    @map("user_id") @db.VarChar(36)
  companyId Int       @map("company_id")
  startTime DateTime  @map("start_time") @db.DateTime
  endTime   DateTime? @map("end_time") @db.DateTime
  duration  Int?      // Duration in seconds (calculated on end)
  createdAt DateTime  @default(now()) @map("created_at")

  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  company         Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  activityLogs    ActivityLog[]
  screenCaptures  ScreenCapture[]

  @@index([userId])
  @@index([companyId])
  @@index([startTime])
  @@map("work_sessions")
}

model ActivityLog {
  id              Int      @id @default(autoincrement())
  userId          String   @map("user_id") @db.VarChar(36)
  companyId       Int      @map("company_id")
  sessionId       Int?     @map("session_id")
  mouseClicks     Int      @default(0) @map("mouse_clicks")
  mouseMovements  Int      @default(0) @map("mouse_movements")
  keystrokes      Int      @default(0) @map("keystrokes")
  activityScore   Int      @default(0) @map("activity_score")
  intervalStart   DateTime @map("interval_start") @db.DateTime
  intervalEnd     DateTime @map("interval_end") @db.DateTime
  createdAt       DateTime @default(now()) @map("created_at")

  user    User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  company Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  session WorkSession? @relation(fields: [sessionId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([companyId])
  @@index([sessionId])
  @@index([intervalStart])
  @@map("activity_logs")
}

model ScreenCapture {
  id         Int      @id @default(autoincrement())
  userId     String   @map("user_id") @db.VarChar(36)
  companyId  Int      @map("company_id")
  sessionId  Int?     @map("session_id")
  imageUrl   String   @map("image_url") @db.VarChar(500)
  pageUrl    String?  @map("page_url") @db.VarChar(500)
  capturedAt DateTime @map("captured_at") @db.DateTime
  createdAt  DateTime @default(now()) @map("created_at")

  user    User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  company Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  session WorkSession? @relation(fields: [sessionId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([companyId])
  @@index([sessionId])
  @@index([capturedAt])
  @@map("screen_captures")
}

// ============================================
// 2. Company Structure
// ============================================

model Department {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(100)
  companyId Int      @map("company_id")
  managerId Int?     @unique @map("manager_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  company   Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  manager   Employee?  @relation("DepartmentManager", fields: [managerId], references: [id], onDelete: SetNull)
  employees Employee[] @relation("DepartmentEmployees")

  @@index([companyId])
  @@index([managerId])
  @@map("departments")
}

model Employee {
  id               Int       @id @default(autoincrement())
  userId           String    @unique @map("user_id") @db.VarChar(36)
  companyId        Int       @map("company_id")
  department       String?   @db.VarChar(100)
  departmentId     Int?      @map("department_id")
  designation      String?   @db.VarChar(100)
  salary           Decimal?  @db.Decimal(10, 2)
  workHours        Decimal?  @map("work_hours") @db.Decimal(5, 2)
  holidays         Int?
  bonus            Decimal?  @db.Decimal(10, 2)
  responsibilities String?   @db.Text
  joinDate         DateTime? @map("join_date") @db.Date
  // Balance and Points fields
  reserveBalance   Decimal   @default(0) @map("reserve_balance") @db.Decimal(12, 2)
  mainBalance      Decimal   @default(0) @map("main_balance") @db.Decimal(12, 2)
  reservePoints    Decimal   @default(0) @map("reserve_points") @db.Decimal(12, 2)
  mainPoints       Decimal   @default(0) @map("main_points") @db.Decimal(12, 2)
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")

  company            Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user               User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  departmentRelation Department? @relation("DepartmentEmployees", fields: [departmentId], references: [id], onDelete: SetNull)
  managedDepartment  Department? @relation("DepartmentManager")

  // Relations
  leadAssignments       LeadAssignment[]
  assignedTasks         Task[]
  assignedConversations SocialConversation[]  @relation("AssignedConversations")
  assignedCalls               LeadCall[]
  assignedMeetings           LeadMeeting[]
  groups                     EmployeeGroupMember[]
  releases                   ConversationRelease[]
  clientApprovalRequestsRequested ClientApprovalRequest[]

  @@index([userId])
  @@index([companyId])
  @@index([departmentId])
  @@map("employees")
}

// ============================================
// 3. CRM (Sales)
// ============================================

enum ClientStatus {
  Processing
  Active

  @@map("client_status")
}

enum ClientApprovalStatus {
  Pending
  Approved
  Rejected

  @@map("client_approval_status")
}

model Client {
  id          Int         @id @default(autoincrement())
  companyId   Int         @map("company_id")
  name        String      @db.VarChar(255)
  contactInfo Json?       @map("contact_info") // e.g., {"phone": "+1234567890", "email": "client@example.com"}
  address     String?     @db.Text
  status      ClientStatus @default(Processing) @map("status")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  company              Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  invoices             Invoice[]
  accountsReceivable   AccountReceivable[]
  payments             Payment[]
  leadMeetings         LeadMeeting[]
  leadCalls            LeadCall[]
  convertedLeads       Lead[]
  clientApprovalRequest ClientApprovalRequest?

  @@index([companyId])
  @@index([status])
  @@map("clients")
}

model ClientApprovalRequest {
  id                    Int                   @id @default(autoincrement())
  companyId             Int                   @map("company_id")
  leadId                Int                   @unique @map("lead_id")
  clientId              Int                   @unique @map("client_id")
  requestedByUserId     String                @map("requested_by_user_id") @db.VarChar(36)
  requestedByEmployeeId Int                   @map("requested_by_employee_id")
  email                 String                @db.VarChar(255)
  passwordHash          String                @map("password_hash") @db.VarChar(255)
  customerPoints        Decimal               @map("customer_points") @db.Decimal(12, 2)
  status                ClientApprovalStatus  @default(Pending)
  approvedByUserId      String?               @map("approved_by_user_id") @db.VarChar(36)
  approvedAt            DateTime?             @map("approved_at") @db.DateTime
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")

  company               Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  lead                  Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)
  client                Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  requestedByUser       User      @relation("ClientApprovalRequestedBy", fields: [requestedByUserId], references: [id], onDelete: Restrict)
  requestedByEmployee   Employee  @relation(fields: [requestedByEmployeeId], references: [id], onDelete: Restrict)
  approvedByUser        User?     @relation("ClientApprovalApprovedBy", fields: [approvedByUserId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([companyId, status])
  @@map("client_approval_requests")
}

model LeadCategory {
  id        Int      @id @default(autoincrement())
  companyId Int      @map("company_id")
  name      String   @db.VarChar(100)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  leads   Lead[]

  @@index([companyId])
  @@index([isActive])
  @@map("lead_categories")
}

model LeadInterest {
  id        Int      @id @default(autoincrement())
  companyId Int      @map("company_id")
  name      String   @db.VarChar(100)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  leads   Lead[]

  @@index([companyId])
  @@index([isActive])
  @@map("lead_interests")
}

enum LeadSource {
  Website
  Referral
  SocialMedia
  Email
  Phone
  Inbox
  FacebookPixel
  Other

  @@map("lead_source")
}

enum LeadStatus {
  New
  Contacted
  Qualified
  Negotiation
  Won
  Lost

  @@map("lead_status")
}

enum CampaignType {
  reach
  sale
  research

  @@map("campaign_type")
}

enum Currency {
  BDT
  USD

  @@map("currency")
}

model Lead {
  id             Int        @id @default(autoincrement())
  companyId      Int        @map("company_id")
  createdBy      String     @map("created_by") // User ID who created the lead
  title          String     @db.VarChar(255)
  description    String?    @db.Text
  source         LeadSource @default(Website)
  status         LeadStatus @default(New)
  value          Decimal?   @db.Decimal(12, 2)
  conversationId Int?       @map("conversation_id") // Link to SocialConversation if from inbox
  customerName   String?    @map("customer_name") @db.VarChar(255)
  phone          String?    @db.VarChar(50)
  categoryId     Int?       @map("category_id")
  interestId     Int?       @map("interest_id")
  campaignId     Int?       @map("campaign_id")
  productId      Int?       @map("product_id") // Link to Product for Sales Lead
  purchasePrice  Decimal?   @map("purchase_price") @db.Decimal(12, 2) // Purchase price from product
  salePrice      Decimal?   @map("sale_price") @db.Decimal(12, 2) // Sale price from product
  profit               Decimal?   @db.Decimal(12, 2) // Calculated profit (salePrice - purchasePrice)
  convertedToClientId  Int?       @map("converted_to_client_id") // Set when lead is converted to client
  leadMonitoringUserId          String?   @map("lead_monitoring_user_id") @db.VarChar(36)
  leadMonitoringAssignedAt      DateTime? @map("lead_monitoring_assigned_at") @db.DateTime
  leadMonitoringTransferredAt   DateTime? @map("lead_monitoring_transferred_at") @db.DateTime
  createdAt            DateTime   @default(now()) @map("created_at")
  updatedAt            DateTime   @updatedAt @map("updated_at")

  company            Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdByUser      User                @relation("LeadCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  leadMonitoringUser User?               @relation("LeadMonitoringManager", fields: [leadMonitoringUserId], references: [id], onDelete: SetNull)
  assignments        LeadAssignment[]
  conversation       SocialConversation? @relation(fields: [conversationId], references: [id], onDelete: SetNull)
  category           LeadCategory?       @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  interest           LeadInterest?       @relation(fields: [interestId], references: [id], onDelete: SetNull)
  campaign           Campaign?           @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  product            Product?            @relation(fields: [productId], references: [id], onDelete: SetNull)
  convertedToClient     Client?                 @relation(fields: [convertedToClientId], references: [id], onDelete: SetNull)
  clientApprovalRequest ClientApprovalRequest?
  meetings              LeadMeeting[]
  calls                 LeadCall[]

  @@index([companyId])
  @@index([createdBy])
  @@index([status])
  @@index([conversationId])
  @@index([categoryId])
  @@index([interestId])
  @@index([campaignId])
  @@index([productId])
  @@index([convertedToClientId])
  @@index([leadMonitoringUserId])
  @@map("leads")
}

model LeadAssignment {
  id         Int      @id @default(autoincrement())
  leadId     Int      @map("lead_id")
  employeeId Int      @map("employee_id")
  assignedAt DateTime @default(now()) @map("assigned_at")

  lead     Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([leadId, employeeId])
  @@index([leadId])
  @@index([employeeId])
  @@map("lead_assignments")
}

enum LeadMeetingStatus {
  Scheduled
  Completed
  Canceled

  @@map("lead_meeting_status")
}

model LeadMeeting {
  id              Int               @id @default(autoincrement())
  companyId       Int               @map("company_id")
  leadId          Int               @map("lead_id")
  clientId        Int?              @map("client_id")
  assignedTo      Int               @map("assigned_to")
  createdBy       String            @map("created_by") @db.VarChar(36)
  title           String            @db.VarChar(255)
  description     String?           @db.Text
  meetingTime     DateTime          @map("meeting_time") @db.DateTime
  durationMinutes Int               @map("duration_minutes")
  googleMeetUrl   String            @map("google_meet_url") @db.VarChar(500)
  status          LeadMeetingStatus @default(Scheduled)
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")

  company            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  lead               Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  client             Client?  @relation(fields: [clientId], references: [id], onDelete: SetNull)
  assignedEmployee   Employee @relation(fields: [assignedTo], references: [id], onDelete: Restrict)

  @@index([companyId])
  @@index([leadId])
  @@index([clientId])
  @@index([assignedTo])
  @@index([status])
  @@index([meetingTime])
  @@map("lead_meetings")
}

enum LeadCallStatus {
  Scheduled
  Completed
  Canceled
  NoAnswer
  Busy
  LeftVoicemail

  @@map("lead_call_status")
}

model LeadCall {
  id              Int            @id @default(autoincrement())
  companyId       Int            @map("company_id")
  leadId          Int            @map("lead_id")
  clientId        Int?           @map("client_id")
  assignedTo      Int            @map("assigned_to")
  createdBy       String         @map("created_by") @db.VarChar(36)
  title           String?        @db.VarChar(255)
  phoneNumber     String?        @map("phone_number") @db.VarChar(50)
  callTime        DateTime       @map("call_time") @db.DateTime
  durationMinutes Int?           @map("duration_minutes")
  status          LeadCallStatus @default(Scheduled)
  notes           String?        @db.Text
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  company          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  lead             Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  client           Client?  @relation(fields: [clientId], references: [id], onDelete: SetNull)
  assignedEmployee Employee @relation(fields: [assignedTo], references: [id], onDelete: Restrict)

  @@index([companyId])
  @@index([leadId])
  @@index([clientId])
  @@index([assignedTo])
  @@index([status])
  @@index([callTime])
  @@map("lead_calls")
}

// ============================================
// 4. Task Management
// ============================================

enum TaskPriority {
  Low
  Medium
  High

  @@map("task_priority")
}

enum TaskStatus {
  Pending
  StartedWorking
  Complete
  Cancel

  @@map("task_status")
}

model Task {
  id             Int          @id @default(autoincrement())
  companyId      Int          @map("company_id")
  title          String       @db.VarChar(255)
  description    String?      @db.Text
  priority       TaskPriority @default(Medium)
  dueDate        DateTime?    @map("due_date") @db.DateTime
  projectId      Int?         @map("project_id")
  assignedTo     Int?         @map("assigned_to")
  groupId        Int?         @map("group_id")
  status         TaskStatus   @default(Pending)
  startedAt      DateTime?    @map("started_at") @db.DateTime
  progress       Decimal?     @default(0) @db.Decimal(5, 2)
  conversationId Int?         @map("conversation_id")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")

  company          Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  project          Project?          @relation(fields: [projectId], references: [id], onDelete: SetNull)
  assignedEmployee Employee?         @relation(fields: [assignedTo], references: [id], onDelete: SetNull)
  group            EmployeeGroup?    @relation(fields: [groupId], references: [id], onDelete: SetNull)
  conversation     TaskConversation?
  comments         TaskComment[]
  subTasks         SubTask[]
  attachments      TaskAttachment[]

  @@index([companyId])
  @@index([assignedTo])
  @@index([projectId])
  @@index([groupId])
  @@index([status])
  @@index([priority])
  @@index([conversationId])
  @@map("tasks")
}

model TaskComment {
  id        Int      @id @default(autoincrement())
  taskId    Int      @map("task_id")
  userId    String   @map("user_id") @db.VarChar(36)
  content   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  task Task @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([userId])
  @@map("task_comments")
}

enum AttachmentFileType {
  image
  pdf
  video
  audio
  link

  @@map("attachment_file_type")
}

enum TaskMessageType {
  text
  image
  file
  audio
  system

  @@map("task_message_type")
}

model SubTask {
  id           Int        @id @default(autoincrement())
  taskId       Int        @map("task_id")
  companyId    Int        @map("company_id")
  title        String     @db.VarChar(255)
  instructions String?    @db.Text
  weight       Decimal    @default(1) @db.Decimal(5, 2)
  status       TaskStatus @default(Pending)
  order        Int        @default(0)
  startedAt    DateTime?  @map("started_at") @db.DateTime
  completedAt  DateTime?  @map("completed_at") @db.DateTime
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  task        Task             @relation(fields: [taskId], references: [id], onDelete: Cascade)
  company     Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  attachments TaskAttachment[]

  @@index([taskId])
  @@index([companyId])
  @@index([status])
  @@index([order])
  @@map("sub_tasks")
}

model TaskAttachment {
  id              Int                @id @default(autoincrement())
  taskId          Int?               @map("task_id")
  subTaskId       Int?               @map("sub_task_id")
  companyId       Int                @map("company_id")
  fileType        AttachmentFileType @map("file_type")
  fileUrl         String?            @map("file_url") @db.VarChar(500)
  fileName        String?            @map("file_name") @db.VarChar(255)
  fileSize        BigInt?            @map("file_size")
  mimeType        String?            @map("mime_type") @db.VarChar(100)
  linkUrl         String?            @map("link_url") @db.VarChar(1000)
  linkTitle       String?            @map("link_title") @db.VarChar(255)
  linkDescription String?            @map("link_description") @db.Text
  thumbnailUrl    String?            @map("thumbnail_url") @db.VarChar(500)
  duration        Int? // Duration in seconds for audio/video
  createdBy       String             @map("created_by") @db.VarChar(36)
  createdAt       DateTime           @default(now()) @map("created_at")
  updatedAt       DateTime           @updatedAt @map("updated_at")

  task     Task?         @relation(fields: [taskId], references: [id], onDelete: Cascade)
  subTask  SubTask?      @relation(fields: [subTaskId], references: [id], onDelete: Cascade)
  company  Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  creator  User          @relation("UserTaskAttachments", fields: [createdBy], references: [id], onDelete: Cascade)
  messages TaskMessage[]

  @@index([taskId])
  @@index([subTaskId])
  @@index([companyId])
  @@index([fileType])
  @@index([createdBy])
  @@map("task_attachments")
}

model TaskConversation {
  id        Int      @id @default(autoincrement())
  taskId    Int      @unique @map("task_id")
  companyId Int      @map("company_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  task     Task          @relation(fields: [taskId], references: [id], onDelete: Cascade)
  company  Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  messages TaskMessage[]

  @@index([taskId])
  @@index([companyId])
  @@map("task_conversations")
}

model TaskMessage {
  id             Int             @id @default(autoincrement())
  conversationId Int             @map("conversation_id")
  senderId       String          @map("sender_id") @db.VarChar(36)
  content        String?         @db.Text
  messageType    TaskMessageType @default(text) @map("message_type")
  attachmentId   Int?            @map("attachment_id")
  isRead         Boolean         @default(false) @map("is_read")
  readAt         DateTime?       @map("read_at") @db.DateTime
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")

  conversation TaskConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User             @relation("UserTaskMessages", fields: [senderId], references: [id], onDelete: Cascade)
  attachment   TaskAttachment?  @relation(fields: [attachmentId], references: [id], onDelete: SetNull)

  @@index([conversationId])
  @@index([senderId])
  @@index([attachmentId])
  @@index([isRead])
  @@index([createdAt])
  @@map("task_messages")
}

// ============================================
// 5. Finance
// ============================================

enum InvoiceStatus {
  Paid
  Unpaid
  Overdue

  @@map("invoice_status")
}

model Invoice {
  id             Int           @id @default(autoincrement())
  companyId      Int           @map("company_id")
  clientId       Int           @map("client_id")
  projectId      Int?          @map("project_id")
  renewedFromId  Int?          @map("renewed_from_id")
  invoiceNumber  String        @unique @map("invoice_number") @db.VarChar(100)
  issueDate      DateTime      @map("issue_date") @db.Date
  dueDate        DateTime      @map("due_date") @db.Date
  totalAmount    Decimal       @map("total_amount") @db.Decimal(12, 2)
  status         InvoiceStatus @default(Unpaid)
  notes          String?       @db.Text
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")

  company            Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  client             Client              @relation(fields: [clientId], references: [id], onDelete: Restrict)
  project            Project?            @relation(fields: [projectId], references: [id], onDelete: SetNull)
  renewedFrom        Invoice?            @relation("InvoiceRenewals", fields: [renewedFromId], references: [id], onDelete: SetNull)
  renewedInvoices    Invoice[]          @relation("InvoiceRenewals")
  items              InvoiceItem[]
  accountsReceivable AccountReceivable[]
  payments           Payment[]
  campaigns          CampaignInvoice[]

  @@index([companyId])
  @@index([clientId])
  @@index([projectId])
  @@index([renewedFromId])
  @@index([status])
  @@index([dueDate])
  @@index([invoiceNumber])
  @@map("invoices")
}

model InvoiceItem {
  id          Int      @id @default(autoincrement())
  invoiceId   Int      @map("invoice_id")
  productId   Int?     @map("product_id")
  serviceId   Int?     @map("service_id")
  description String   @db.VarChar(255)
  quantity    Decimal  @db.Decimal(10, 2)
  unitPrice   Decimal  @map("unit_price") @db.Decimal(12, 2)
  total       Decimal  @db.Decimal(12, 2)
  createdAt   DateTime @default(now()) @map("created_at")

  invoice Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  service Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)

  @@index([invoiceId])
  @@index([productId])
  @@index([serviceId])
  @@map("invoice_items")
}

// ============================================
// Payment Gateway & Payment Models
// ============================================

model PaymentGateway {
  id            Int      @id @default(autoincrement())
  companyId     Int      @map("company_id")
  name          String   @db.VarChar(100)
  accountType   String   @map("account_type") @db.VarChar(50)
  accountNumber String   @map("account_number") @db.VarChar(20)
  instructions  String?  @db.Text
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  company  Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  payments Payment[]

  @@index([companyId])
  @@index([isActive])
  @@map("payment_gateways")
}

enum PaymentStatus {
  Pending
  Approved
  Rejected
  Cancelled

  @@map("payment_status")
}

model Payment {
  id               Int           @id @default(autoincrement())
  companyId        Int           @map("company_id")
  invoiceId        Int           @map("invoice_id")
  projectId        Int?          @map("project_id")
  clientId         Int           @map("client_id")
  paymentGatewayId Int           @map("payment_gateway_id")
  amount           Decimal       @db.Decimal(12, 2)
  transactionId    String?       @map("transaction_id") @db.VarChar(100)
  paymentMethod    String        @map("payment_method") @db.VarChar(50)
  status           PaymentStatus @default(Pending)
  paidBy           String?       @map("paid_by") @db.VarChar(255)
  notes            String?       @db.Text
  adminNotes       String?       @map("admin_notes") @db.Text
  paidAt           DateTime?     @map("paid_at")
  verifiedAt       DateTime?     @map("verified_at")
  verifiedBy       String?       @map("verified_by") @db.VarChar(36)
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")

  company        Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  invoice        Invoice        @relation(fields: [invoiceId], references: [id], onDelete: Restrict)
  project        Project?       @relation(fields: [projectId], references: [id], onDelete: SetNull)
  client         Client         @relation(fields: [clientId], references: [id], onDelete: Restrict)
  paymentGateway PaymentGateway @relation(fields: [paymentGatewayId], references: [id], onDelete: Restrict)

  @@index([companyId])
  @@index([invoiceId])
  @@index([projectId])
  @@index([clientId])
  @@index([status])
  @@index([paymentGatewayId])
  @@map("payments")
}

enum TransactionType {
  Credit
  Debit

  @@map("transaction_type")
}

model Transaction {
  id          Int             @id @default(autoincrement())
  companyId   Int             @map("company_id")
  type        TransactionType
  categoryId  Int?            @map("category_id")
  amount      Decimal         @db.Decimal(12, 2)
  date        DateTime        @db.Date
  description String?         @db.Text
  reference   String?         @db.VarChar(255)
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  company  Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  category ExpenseCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([type])
  @@index([categoryId])
  @@index([date])
  @@map("transactions")
}

model ExpenseCategory {
  id          Int      @id @default(autoincrement())
  companyId   Int      @map("company_id")
  name        String   @db.VarChar(100)
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  transactions Transaction[]
  budgets      Budget[]

  @@index([companyId])
  @@map("expense_categories")
}

model Budget {
  id         Int      @id @default(autoincrement())
  companyId  Int      @map("company_id")
  name       String   @db.VarChar(255)
  categoryId Int?     @map("category_id")
  amount     Decimal  @db.Decimal(12, 2)
  period     String   @db.VarChar(50) // Monthly, Quarterly, Yearly
  startDate  DateTime @map("start_date") @db.Date
  endDate    DateTime @map("end_date") @db.Date
  spent      Decimal  @default(0) @db.Decimal(12, 2)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  company  Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  category ExpenseCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([categoryId])
  @@index([startDate])
  @@index([endDate])
  @@map("budgets")
}

model AccountPayable {
  id          Int       @id @default(autoincrement())
  companyId   Int       @map("company_id")
  vendorName  String    @map("vendor_name") @db.VarChar(255)
  amount      Decimal   @db.Decimal(12, 2)
  dueDate     DateTime  @map("due_date") @db.Date
  status      String    @default("Pending") @db.VarChar(50) // Pending, Paid, Overdue
  description String?   @db.Text
  paidDate    DateTime? @map("paid_date") @db.Date
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([status])
  @@index([dueDate])
  @@map("accounts_payable")
}

model AccountReceivable {
  id          Int       @id @default(autoincrement())
  companyId   Int       @map("company_id")
  clientId    Int?      @map("client_id")
  invoiceId   Int?      @map("invoice_id")
  amount      Decimal   @db.Decimal(12, 2)
  dueDate     DateTime  @map("due_date") @db.Date
  status      String    @default("Pending") @db.VarChar(50) // Pending, Paid, Overdue
  description String?   @db.Text
  paidDate    DateTime? @map("paid_date") @db.Date
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  company Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  client  Client?  @relation(fields: [clientId], references: [id], onDelete: SetNull)
  invoice Invoice? @relation(fields: [invoiceId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([clientId])
  @@index([invoiceId])
  @@index([status])
  @@index([dueDate])
  @@map("accounts_receivable")
}

// ============================================
// 6. Social Integrations & Inbox
// ============================================

enum IntegrationProvider {
  facebook
  whatsapp

  @@map("integration_provider")
}

enum WebhookMode {
  local
  live

  @@map("webhook_mode")
}

model Integration {
  id                Int                 @id @default(autoincrement())
  companyId         Int                 @map("company_id")
  provider          IntegrationProvider
  pageId            String              @map("page_id") @db.VarChar(255) // For Chatwoot: inbox_id; for Facebook: page ID
  accessToken       String              @map("access_token") @db.Text // Should be encrypted
  accountId         String?             @map("account_id") @db.VarChar(255) // For Chatwoot: account_id
  baseUrl           String?             @map("base_url") @db.VarChar(500) // For Chatwoot: base URL (optional, defaults to cloud)
  isActive          Boolean             @default(true) @map("is_active")
  webhookMode       WebhookMode?        @default(local) @map("webhook_mode") // For Chatwoot: local or live server mode
  isWebhookActive   Boolean             @default(false) @map("is_webhook_active") // Enable/disable webhook (like live/test mode)
  displayName       String?             @map("display_name") @db.VarChar(255) // Page name for Facebook
  metaJson          Json?               @map("meta_json") // Page picture/category etc.
  lastError         String?             @map("last_error") @db.Text
  lastValidatedAt   DateTime?           @map("last_validated_at") @db.DateTime
  lastWebhookAt     DateTime?           @map("last_webhook_at") @db.DateTime
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, provider, pageId])
  @@index([companyId])
  @@index([provider])
  @@index([isActive])
  @@map("integrations")
}

model FacebookAppConfig {
  id                   Int      @id @default(autoincrement())
  companyId            Int      @unique @map("company_id")
  appId                String   @map("app_id") @db.VarChar(100)
  appSecret            String   @map("app_secret") @db.VarChar(255)
  verifyToken          String   @map("verify_token") @db.VarChar(255)
  redirectUriOverride  String?  @map("redirect_uri_override") @db.VarChar(500)
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("facebook_app_configs")
}

enum SocialPlatform {
  facebook
  whatsapp

  @@map("social_platform")
}

enum BlogStatus {
  Draft
  Published
  Archived

  @@map("blog_status")
}

enum ConversationStatus {
  Open
  Closed

  @@map("conversation_status")
}

model SocialConversation {
  id                Int                @id @default(autoincrement())
  companyId         Int                @map("company_id")
  platform          SocialPlatform
  externalUserId    String             @map("external_user_id") @db.VarChar(255) // Sender's PSID from Facebook
  externalUserName  String?            @map("external_user_name") @db.VarChar(255) // Sender's Name
  status            ConversationStatus @default(Open)
  lastMessageAt     DateTime?          @map("last_message_at") @db.DateTime
  assignedTo        Int?               @map("assigned_to")
  assignedAt        DateTime?          @map("assigned_at") @db.DateTime
  whatsappSlotId    String?            @map("whatsapp_slot_id") @db.VarChar(10) // Slot 1-5 for multi-WhatsApp
  facebookPageId    String?            @map("facebook_page_id") @db.VarChar(255) // Source Page ID for Facebook
  facebookPageName  String?            @map("facebook_page_name") @db.VarChar(255) // Page display name
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")

  company          Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  assignedEmployee Employee?             @relation("AssignedConversations", fields: [assignedTo], references: [id], onDelete: SetNull)
  messages         SocialMessage[]
  leads            Lead[]
  releases         ConversationRelease[]
  labels           ConversationLabel[]

  @@index([companyId])
  @@index([platform])
  @@index([externalUserId])
  @@index([status])
  @@index([lastMessageAt])
  @@index([assignedTo])
  @@index([whatsappSlotId])
  @@index([facebookPageId])
  @@map("social_conversations")
}

enum SenderType {
  customer
  agent

  @@map("sender_type")
}

model SocialMessage {
  id             Int        @id @default(autoincrement())
  conversationId Int        @map("conversation_id")
  senderType     SenderType @map("sender_type")
  content        String     @db.Text
  imageUrl       String?    @map("image_url") @db.VarChar(500)
  isRead         Boolean    @default(false) @map("is_read")
  readAt         DateTime?  @map("read_at") @db.DateTime
  isSeen         Boolean    @default(false) @map("is_seen")
  seenAt         DateTime?  @map("seen_at") @db.DateTime
  createdAt      DateTime   @default(now()) @map("created_at")

  conversation SocialConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([createdAt])
  @@index([imageUrl])
  @@index([isRead])
  @@index([isSeen])
  @@map("social_messages")
}

model ConversationRelease {
  id             Int      @id @default(autoincrement())
  conversationId Int      @map("conversation_id")
  employeeId     Int      @map("employee_id")
  companyId      Int      @map("company_id")
  releasedAt     DateTime @default(now()) @map("released_at") @db.DateTime
  createdAt      DateTime @default(now()) @map("created_at")

  conversation SocialConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  employee     Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  company      Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([employeeId])
  @@index([companyId])
  @@index([releasedAt])
  @@map("conversation_releases")
}

model ConversationLabel {
  id             Int      @id @default(autoincrement())
  conversationId Int      @map("conversation_id")
  companyId      Int      @map("company_id")
  name           String   @db.VarChar(50)
  source         String?  @db.VarChar(100)
  createdBy      String   @map("created_by") @db.VarChar(36)
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  conversation SocialConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  company      Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([companyId])
  @@index([name])
  @@map("conversation_labels")
}

// ============================================
// 7. Content
// ============================================

model Review {
  id         Int      @id @default(autoincrement())
  companyId  Int?     @map("company_id")
  authorName String   @map("author_name") @db.VarChar(150)
  role       String?  @db.VarChar(150)
  rating     Int
  comment    String   @db.Text
  isFeatured Boolean  @default(false) @map("is_featured")
  createdAt  DateTime @default(now()) @map("created_at")

  company Company? @relation(fields: [companyId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@map("reviews")
}

model BlogPost {
  id          Int        @id @default(autoincrement())
  companyId   Int?       @map("company_id")
  title       String     @db.VarChar(255)
  slug        String     @unique @db.VarChar(255)
  excerpt     String?    @db.VarChar(500)
  content     String     @db.Text
  coverImage  String?    @map("cover_image") @db.VarChar(500)
  tags        Json?
  status      BlogStatus @default(Published)
  publishedAt DateTime?  @map("published_at") @db.DateTime
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")

  company Company? @relation(fields: [companyId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([status])
  @@map("blog_posts")
}

// ============================================
// 8. Company Management
// ============================================

model CompanyContact {
  id          Int      @id @default(autoincrement())
  companyId   Int      @map("company_id")
  type        String   @db.VarChar(50) // Phone, Email, Meeting, Note
  value       String   @db.VarChar(255)
  description String?  @db.Text
  date        DateTime @db.DateTime
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([date])
  @@map("company_contacts")
}

enum ContractStatus {
  Draft
  Active
  Expired
  Cancelled

  @@map("contract_status")
}

model Contract {
  id          Int            @id @default(autoincrement())
  companyId   Int            @map("company_id")
  title       String         @db.VarChar(255)
  description String?        @db.Text
  value       Decimal?       @db.Decimal(12, 2)
  startDate   DateTime       @map("start_date") @db.Date
  endDate     DateTime?      @map("end_date") @db.Date
  status      ContractStatus @default(Draft)
  documentUrl String?        @map("document_url") @db.VarChar(500)
  createdAt   DateTime       @default(now()) @map("created_at")
  updatedAt   DateTime       @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([status])
  @@index([startDate])
  @@map("contracts")
}

// ============================================
// 8. System Settings & Root Items
// ============================================

model SystemSetting {
  id          Int      @id @default(autoincrement())
  companyId   Int      @map("company_id")
  key         String   @db.VarChar(100)
  value       String   @db.Text
  description String?  @db.VarChar(255)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, key])
  @@index([companyId])
  @@index([key])
  @@map("system_settings")
}

// ============================================
// 9. Campaign Management
// ============================================

model Campaign {
  id          Int          @id @default(autoincrement())
  companyId   Int          @map("company_id")
  projectId   Int          @map("project_id")
  name        String       @db.VarChar(255)
  description String?      @db.Text
  startDate   DateTime     @map("start_date") @db.Date
  endDate     DateTime     @map("end_date") @db.Date
  budget      Decimal      @db.Decimal(12, 2)
  type        CampaignType @default(sale)
  isActive    Boolean      @default(true) @map("is_active")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  company  Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  project  Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  leads    Lead[]
  products CampaignProduct[]
  clients  CampaignClient[]
  invoices CampaignInvoice[]
  groups   CampaignGroup[]

  @@index([companyId])
  @@index([projectId])
  @@index([type])
  @@index([startDate])
  @@index([endDate])
  @@index([isActive])
  @@map("campaigns")
}

// ============================================
// 10. Product Management
// ============================================

model ProductCategory {
  id          Int      @id @default(autoincrement())
  companyId   Int      @map("company_id")
  name        String   @db.VarChar(255)
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  company  Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  products Product[]

  @@index([companyId])
  @@index([name])
  @@map("product_categories")
}

model Product {
  id             Int      @id @default(autoincrement())
  companyId      Int      @map("company_id")
  categoryId     Int      @map("category_id")
  name           String   @db.VarChar(255)
  description    String?  @db.Text
  purchasePrice  Decimal  @map("purchase_price") @db.Decimal(12, 2)
  salePrice      Decimal  @map("sale_price") @db.Decimal(12, 2)
  currency       Currency @default(BDT)
  productCompany String?  @map("product_company") @db.VarChar(255)
  imageUrl       String?  @map("image_url") @db.VarChar(500)
  quickReplies   Json?    @map("quick_replies")
  leadPoint      Decimal? @map("lead_point") @db.Decimal(10, 2)
  customerPoint  Decimal? @map("customer_point") @db.Decimal(10, 2)
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  company       Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  category      ProductCategory   @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  campaigns     CampaignProduct[]
  leads         Lead[]
  invoiceItems  InvoiceItem[]

  @@index([companyId])
  @@index([categoryId])
  @@index([name])
  @@index([currency])
  @@map("products")
}

// ============================================
// 11. Campaign Product Assignment
// ============================================

model CampaignProduct {
  id         Int      @id @default(autoincrement())
  campaignId Int      @map("campaign_id")
  productId  Int      @map("product_id")
  createdAt  DateTime @default(now()) @map("created_at")

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  product  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([campaignId, productId])
  @@index([campaignId])
  @@index([productId])
  @@map("campaign_products")
}

// ============================================
// 12. Project Management
// ============================================

enum ProjectStatus {
  Draft
  Submitted
  StartedWorking
  InProgress
  Completed
  Cancelled

  @@map("project_status")
}

model Project {
  id                Int           @id @default(autoincrement())
  companyId         Int           @map("company_id")
  clientId          String        @map("client_id") @db.VarChar(36)
  serviceId         Int?          @map("service_id")
  title             String        @db.VarChar(255)
  description       String?       @db.Text
  budget            Decimal       @db.Decimal(12, 2)
  deliveryStartDate DateTime?     @map("delivery_start_date") @db.Date
  deliveryEndDate   DateTime?     @map("delivery_end_date") @db.Date
  time              String        @db.VarChar(100)
  status            ProjectStatus @default(Draft)
  signature         String?       @db.Text
  documentUrl       String?       @map("document_url") @db.VarChar(500)
  signedAt          DateTime?     @map("signed_at") @db.DateTime
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")

  company   Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  client    User       @relation(fields: [clientId], references: [id], onDelete: Cascade)
  service   Service?   @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  invoices  Invoice[]
  payments  Payment[]
  campaigns Campaign[]
  tasks     Task[]

  @@index([companyId])
  @@index([clientId])
  @@index([serviceId])
  @@index([status])
  @@map("projects")
}

// ============================================
// 12.5. Service Categories
// ============================================

model ServiceCategory {
  id          Int      @id @default(autoincrement())
  companyId   Int      @map("company_id")
  parentId    Int?     @map("parent_id")
  name        String   @db.VarChar(255)
  description String?  @db.Text
  iconName    String?  @map("icon_name") @db.VarChar(100)
  iconUrl     String?  @map("icon_url") @db.VarChar(500)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  company   Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  parent    ServiceCategory? @relation("ServiceCategoryHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children  ServiceCategory[] @relation("ServiceCategoryHierarchy")
  services  Service[]

  @@index([companyId])
  @@index([parentId])
  @@map("service_categories")
}

// ============================================
// 13. Services
// ============================================

model Service {
  id                Int       @id @default(autoincrement())
  companyId         Int       @map("company_id")
  categoryId        Int?      @map("category_id")
  title             String    @db.VarChar(255)
  details           String    @db.Text
  pricing           Decimal   @db.Decimal(12, 2)
  useDeliveryDate   Boolean   @default(true) @map("use_delivery_date")
  durationDays      Int?      @map("duration_days")
  deliveryStartDate DateTime? @map("delivery_start_date") @db.Date
  deliveryEndDate   DateTime? @map("delivery_end_date") @db.Date
  currency          String    @default("BDT") @db.VarChar(10)
  attributes        Json // { keyValuePairs: {[key: string]: string}, tags: string[] }
  isActive          Boolean   @default(true) @map("is_active")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  company       Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  category      ServiceCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  projects      Project[]
  invoiceItems  InvoiceItem[]

  @@index([companyId])
  @@index([categoryId])
  @@index([isActive])
  @@map("services")
}

// ============================================
// 14. Campaign Client Assignment
// ============================================

model CampaignClient {
  id         Int      @id @default(autoincrement())
  campaignId Int      @map("campaign_id")
  clientId   String   @map("client_id") @db.VarChar(36)
  createdAt  DateTime @default(now()) @map("created_at")

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  client   User     @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@unique([campaignId, clientId])
  @@index([campaignId])
  @@index([clientId])
  @@map("campaign_clients")
}

// ============================================
// 15. Campaign Employee Assignment (DEPRECATED - Removed)
// ============================================

// ============================================
// 16. Employee Groups
// ============================================

model EmployeeGroup {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(255)
  description String   @db.Text
  companyId   Int      @map("company_id")
  createdById String   @map("created_by_id") @db.VarChar(36)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  company   Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  creator   User                  @relation(fields: [createdById], references: [id], onDelete: Restrict)
  members   EmployeeGroupMember[]
  campaigns CampaignGroup[]
  tasks     Task[]

  @@index([companyId])
  @@index([createdById])
  @@map("employee_groups")
}

model EmployeeGroupMember {
  id         Int      @id @default(autoincrement())
  groupId    Int      @map("group_id")
  employeeId Int      @map("employee_id")
  createdAt  DateTime @default(now()) @map("created_at")

  group    EmployeeGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  employee Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([groupId, employeeId])
  @@index([groupId])
  @@index([employeeId])
  @@map("employee_group_members")
}

// ============================================
// 17. Campaign Invoice Assignment
// ============================================

model CampaignInvoice {
  id         Int      @id @default(autoincrement())
  campaignId Int      @map("campaign_id")
  invoiceId  Int      @map("invoice_id")
  createdAt  DateTime @default(now()) @map("created_at")

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  invoice  Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@unique([campaignId, invoiceId])
  @@index([campaignId])
  @@index([invoiceId])
  @@map("campaign_invoices")
}

// ============================================
// 18. Campaign Group Assignment
// ============================================

model CampaignGroup {
  id         Int      @id @default(autoincrement())
  campaignId Int      @map("campaign_id")
  groupId    Int      @map("group_id")
  createdAt  DateTime @default(now()) @map("created_at")

  campaign Campaign      @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  group    EmployeeGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([campaignId, groupId])
  @@index([campaignId])
  @@index([groupId])
  @@map("campaign_groups")
}
